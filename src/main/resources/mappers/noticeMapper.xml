<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="noticeMapper">
<sql id="search">
	<trim prefix="where">
		<if test="search=='title'">
			TITLE like '%'||#{find}||'%'
		</if>
		<if test="search=='writer'">
			WRITER like '%'||#{find}||'%'
		</if>
		<if test="search=='content'">
			CONTENT like '%'||#{find}||'%'
		</if>
	</trim>
</sql>
	<select id="view" resultType="com.choa.notice.NoticeDTO" parameterType="java.lang.Integer"> 
	<!-- id: SQL문을 호출한 메소드를 구분 -->
	<!-- resultType: SQL문의 결과물이 리턴되는 데이터타입 -->
	<!-- parameterType: SQL문의 ?에 들어갈 내용의 데이터타입 -->
		select * from NOTICE where NUM=#{num} <!-- 여러 파라미터를 사용하는 경우. 물음표 대신 #{파라미터네임} -->
	</select>
	<!-- insert, update, delete는 전부 int를 리턴하므로 굳이 resultType을 지정할 필요 없음. -->
	<insert id="write" parameterType="com.choa.notice.NoticeDTO">
		insert into NOTICE values(NOTICE_SEQ.NEXTVAL, #{writer}, #{title}, #{content}, SYSDATE, 0, '', '')
	</insert>
	<update id="update" parameterType="com.choa.notice.NoticeDTO">
		update NOTICE set TITLE=#{title}, CONTENT=#{content} where NUM=#{num}
	</update>
	<delete id="delete" parameterType="java.lang.Integer">
		delete NOTICE where NUM=#{num}
	</delete>
	<select id="list" parameterType="com.choa.util.ListInfo" resultType="com.choa.notice.NoticeDTO">
		select * from
		 (select ROWNUM R, N.* from
		  (select * from NOTICE  
		 	<include refid="search"></include>
		 	 order by NUM desc) N)
		   where R between #{firstRow} and #{lastRow}
	</select>
	<select id="count" resultType="java.lang.Integer" parameterType="com.choa.util.ListInfo">
		select NVL(COUNT(NUM), 0) from NOTICE
		 	<include refid="search"></include>
	</select>
</mapper>